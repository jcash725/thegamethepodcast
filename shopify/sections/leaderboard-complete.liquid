{% comment %}
  Complete Leaderboard Section with Weekly + Category tabs
  Structure: Week 1, Week 2, etc. -> Each week has 1-Flex and 2-Flex tabs -> Season Leaders
{% endcomment %}

{{ 'thegame-leaderboard.css' | asset_url | stylesheet_tag }}

<div class="container">
  <header class="header">
    <div class="top-image-container">
      {% if section.settings.header_image %}
        <img src="{{ section.settings.header_image | image_url }}" alt="The Game Header" class="top-image" />
      {% else %}
        <img src="{{ 'thegame-thegame_logo.png' | asset_url }}" alt="The Game Header" class="top-image" />
      {% endif %}
    </div>
    
    <!-- Weekly Tabs -->
    <div class="tabs">
      {% for i in (1..section.settings.total_weeks) %}
        <button class="tab-button {% if i == section.settings.active_week %}active{% endif %}" onclick="showWeek({{ i }})">Week {{ i }}</button>
      {% endfor %}
      <button class="tab-button" onclick="showWeek('season')">Season Leaders</button>
    </div>

    <div class="season-title">{{ section.settings.title | default: 'LEADERBOARD' }}</div>
  </header>

  <!-- Weekly Content -->
  {% for week in (1..section.settings.total_weeks) %}
    <div id="week{{ week }}" class="week-content {% if week == section.settings.active_week %}active{% endif %}">
      
      <!-- Category tabs for this week -->
      <div class="category-tabs">
        <button class="category-tab-button active" onclick="showCategory({{ week }}, 'oneflex')">1-Flex Leagues</button>
        <button class="category-tab-button" onclick="showCategory({{ week }}, 'twoflex')">2-Flex Leagues</button>
      </div>

      <!-- 1-Flex content for this week -->
      <div id="week{{ week }}-oneflex" class="category-content active">
        <div class="leaderboard-section">
          <div class="league-table">
            <table>
              <thead>
                <tr>
                  <th>NO</th>
                  <th>TEAM</th>
                  <th>LEAGUE</th>
                  <th>PTS</th>
                </tr>
              </thead>
              <tbody>
                {% for block in section.blocks %}
                  {% if block.settings.week == week and block.settings.flex_type == '1-flex' %}
                    <tr class="{{ block.settings.row_class }}">
                      <td><div class="rank-circle">{{ block.settings.rank }}</div></td>
                      <td class="team-cell">
                        <div class="team-name">{{ block.settings.team_name }}</div>
                        <div class="username">@{{ block.settings.username }}</div>
                      </td>
                      <td class="league-cell">
                        <div class="league-name">{{ block.settings.league_name }}</div>
                      </td>
                      <td class="points-cell">
                        <div class="total-points">{{ block.settings.points }}</div>
                      </td>
                    </tr>
                  {% endif %}
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- 2-Flex content for this week -->
      <div id="week{{ week }}-twoflex" class="category-content">
        <div class="leaderboard-section">
          <div class="league-table">
            <table>
              <thead>
                <tr>
                  <th>NO</th>
                  <th>TEAM</th>
                  <th>LEAGUE</th>
                  <th>PTS</th>
                </tr>
              </thead>
              <tbody>
                {% for block in section.blocks %}
                  {% if block.settings.week == week and block.settings.flex_type == '2-flex' %}
                    <tr class="{{ block.settings.row_class }}">
                      <td><div class="rank-circle">{{ block.settings.rank }}</div></td>
                      <td class="team-cell">
                        <div class="team-name">{{ block.settings.team_name }}</div>
                        <div class="username">@{{ block.settings.username }}</div>
                      </td>
                      <td class="league-cell">
                        <div class="league-name">{{ block.settings.league_name }}</div>
                      </td>
                      <td class="points-cell">
                        <div class="total-points">{{ block.settings.points }}</div>
                      </td>
                    </tr>
                  {% endif %}
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>

    </div>
  {% endfor %}

  <!-- Season Leaders Content -->
  <div id="weekseason" class="week-content">
    
    <!-- Category tabs for season -->
    <div class="category-tabs">
      <button class="category-tab-button active" onclick="showCategory('season', 'oneflex')">1-Flex Season Leaders</button>
      <button class="category-tab-button" onclick="showCategory('season', 'twoflex')">2-Flex Season Leaders</button>
    </div>

    <!-- 1-Flex Season Leaders -->
    <div id="weekseason-oneflex" class="category-content active">
      <div class="leaderboard-section">
        <div class="league-table">
          <table>
            <thead>
              <tr>
                <th>NO</th>
                <th>TEAM</th>
                <th>LEAGUE</th>
                <th>TOTAL PTS</th>
              </tr>
            </thead>
            <tbody>
              {% for block in section.blocks %}
                {% if block.settings.week == 'season' and block.settings.flex_type == '1-flex' %}
                  <tr class="{{ block.settings.row_class }}">
                    <td><div class="rank-circle">{{ block.settings.rank }}</div></td>
                    <td class="team-cell">
                      <div class="team-name">{{ block.settings.team_name }}</div>
                      <div class="username">@{{ block.settings.username }}</div>
                    </td>
                    <td class="league-cell">
                      <div class="league-name">{{ block.settings.league_name }}</div>
                    </td>
                    <td class="points-cell">
                      <div class="total-points">{{ block.settings.points }}</div>
                    </td>
                  </tr>
                {% endif %}
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- 2-Flex Season Leaders -->
    <div id="weekseason-twoflex" class="category-content">
      <div class="leaderboard-section">
        <div class="league-table">
          <table>
            <thead>
              <tr>
                <th>NO</th>
                <th>TEAM</th>
                <th>LEAGUE</th>
                <th>TOTAL PTS</th>
              </tr>
            </thead>
            <tbody>
              {% for block in section.blocks %}
                {% if block.settings.week == 'season' and block.settings.flex_type == '2-flex' %}
                  <tr class="{{ block.settings.row_class }}">
                    <td><div class="rank-circle">{{ block.settings.rank }}</div></td>
                    <td class="team-cell">
                      <div class="team-name">{{ block.settings.team_name }}</div>
                      <div class="username">@{{ block.settings.username }}</div>
                    </td>
                    <td class="league-cell">
                      <div class="league-name">{{ block.settings.league_name }}</div>
                    </td>
                    <td class="points-cell">
                      <div class="total-points">{{ block.settings.points }}</div>
                    </td>
                  </tr>
                {% endif %}
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>

  </div>
  
  <footer class="footer">
    {% if section.settings.footer_image %}
      <img src="{{ section.settings.footer_image | image_url }}" alt="living in fantasy" class="top-image" />
    {% else %}
      <img src="{{ 'thegame-living-in-fantasy.png' | asset_url }}" alt="living in fantasy" class="top-image" />
    {% endif %}

    <p style="font-size: 0.9rem; opacity: 0.8;">{{ section.settings.update_text | default: 'Updated:' }} {{ 'now' | date: '%B %d, %Y at %I:%M %p' }}</p>
  </footer>
</div>

<style>
  /* Additional styles for nested tabs */
  .week-content {
    display: none;
  }
  
  .week-content.active {
    display: block;
    animation: fadeIn 0.3s ease-in-out;
  }
  
  .category-tabs {
    display: flex;
    flex-wrap: wrap;
    gap: 5px;
    margin-bottom: 20px;
    background: rgba(255, 255, 255, 0.05);
    padding: 8px;
    border-radius: 8px;
    justify-content: center;
  }
  
  .category-tab-button {
    background: rgba(26, 54, 93, 0.7);
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.9rem;
    font-weight: 500;
    transition: all 0.3s ease;
    text-transform: uppercase;
  }
  
  .category-tab-button:hover {
    background: rgba(45, 74, 102, 0.8);
    transform: translateY(-1px);
  }
  
  .category-tab-button.active {
    background: linear-gradient(135deg, #DC143C, #B91C1C);
    color: white;
    transform: translateY(-1px);
    box-shadow: 0 3px 10px rgba(220, 20, 60, 0.3);
  }
  
  .category-content {
    display: none;
  }
  
  .category-content.active {
    display: block;
  }
</style>

<script>
  function showWeek(week) {
    // Hide all week contents
    document.querySelectorAll('.week-content').forEach(content => {
      content.classList.remove('active');
    });
    
    // Remove active class from all tab buttons
    document.querySelectorAll('.tab-button').forEach(button => {
      button.classList.remove('active');
    });
    
    // Show selected week content
    document.getElementById('week' + week).classList.add('active');
    
    // Add active class to selected tab button
    event.target.classList.add('active');
    
    // Show default category (1-flex) for the selected week
    showCategory(week, 'oneflex');
  }
  
  function showCategory(week, category) {
    // Hide all category contents for this week
    document.querySelectorAll(`#week${week}-oneflex, #week${week}-twoflex`).forEach(content => {
      content.classList.remove('active');
    });
    
    // Remove active class from category tab buttons
    document.querySelectorAll('.category-tab-button').forEach(button => {
      button.classList.remove('active');
    });
    
    // Show selected category content
    document.getElementById(`week${week}-${category}`).classList.add('active');
    
    // Add active class to selected category button
    event.target.classList.add('active');
  }
</script>

{% schema %}
{
  "name": "Complete Leaderboard",
  "settings": [
    {
      "type": "header",
      "content": "General Settings"
    },
    {
      "type": "image_picker",
      "id": "header_image",
      "label": "Header Image"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Page Title",
      "default": "LEADERBOARD"
    },
    {
      "type": "number",
      "id": "total_weeks",
      "label": "Total Weeks",
      "default": 1
    },
    {
      "type": "number",
      "id": "active_week",
      "label": "Active Week (Default)",
      "default": 1
    },
    {
      "type": "header",
      "content": "Footer Settings"
    },
    {
      "type": "image_picker",
      "id": "footer_image",
      "label": "Footer Image"
    },
    {
      "type": "text",
      "id": "update_text",
      "label": "Update Text",
      "default": "Updated:"
    }
  ],
  "blocks": [
    {
      "type": "leaderboard_entry",
      "name": "Leaderboard Entry",
      "settings": [
        {
          "type": "select",
          "id": "week",
          "label": "Week",
          "options": [
            { "value": "1", "label": "Week 1" },
            { "value": "2", "label": "Week 2" },
            { "value": "3", "label": "Week 3" },
            { "value": "4", "label": "Week 4" },
            { "value": "5", "label": "Week 5" },
            { "value": "season", "label": "Season Total" }
          ],
          "default": "1"
        },
        {
          "type": "select",
          "id": "flex_type",
          "label": "Flex Type",
          "options": [
            { "value": "1-flex", "label": "1-Flex" },
            { "value": "2-flex", "label": "2-Flex" }
          ],
          "default": "1-flex"
        },
        {
          "type": "number",
          "id": "rank",
          "label": "Rank",
          "default": 1
        },
        {
          "type": "text",
          "id": "team_name",
          "label": "Team Name"
        },
        {
          "type": "text", 
          "id": "username",
          "label": "Username"
        },
        {
          "type": "text",
          "id": "league_name",
          "label": "League Name"
        },
        {
          "type": "text",
          "id": "points",
          "label": "Points"
        },
        {
          "type": "select",
          "id": "row_class",
          "label": "Row Style",
          "options": [
            { "value": "", "label": "Default" },
            { "value": "champion", "label": "Champion" },
            { "value": "podium", "label": "Podium" }
          ],
          "default": ""
        }
      ]
    }
  ]
}
{% endschema %}